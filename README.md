# XRK-Yunzai v3.0.5

åŸºäºä¹ç¥ç‰ˆ[äº‘å´½v3.0](https://gitee.com/le-niao/Yunzai-Bot) ä¸å–µå–µç‰ˆ[å–µå´½v3.1.3](https://gitee.com/yoimiya-kokomi/Miao-Yunzai) è¿˜æœ‰æ—¶é›¨ç‰ˆ[æ—¶é›¨å´½3.1.3](https://gitee.com/TimeRainStarSky/Yunzai)

æ„Ÿè°¢æˆ‘åœ¨ç¼–å†™è¿‡ç¨‹ä¸­æ—¶é›¨ä½¬ç­‰ä½¬çš„å¸®åŠ©
æ„Ÿè°¢æˆ‘åœ¨ç¼–å†™æ—¶èŒæ–°ä»¬çš„æ”¯æŒ

## é¡¹ç›®ç‰¹æ€§

### ğŸš€ æ¨¡å—åŒ–å·¥ä½œæµç³»ç»Ÿ

XRK-Yunzai é‡‡ç”¨æ¨¡å—åŒ–å·¥ä½œæµæ¶æ„ï¼Œæ”¯æŒï¼š

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªå·¥ä½œæµä¸“æ³¨äºç‰¹å®šåŠŸèƒ½ï¼ˆèŠå¤©ã€æ–‡ä»¶ã€è®¾å¤‡ç­‰ï¼‰
- **ç»„åˆè°ƒç”¨**ï¼šå¯ä»¥åŒæ—¶è°ƒç”¨å¤šä¸ªå·¥ä½œæµï¼Œå®ç°å¤æ‚éœ€æ±‚
- **è®°å¿†ç³»ç»Ÿ**ï¼šæ‰€æœ‰å·¥ä½œæµè‡ªåŠ¨è·å¾—è®°å¿†èƒ½åŠ›ï¼Œæ”¯æŒåœºæ™¯éš”ç¦»
- **æ¨ç†è°ƒä¼˜**ï¼šæ”¯æŒå¤šè½®æ¨ç†å’Œå“åº”æ¶¦è‰²ï¼Œæå‡AIå›å¤è´¨é‡
- **å‚æ•°ä¼˜å…ˆçº§**ï¼šçµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒè¿è¡Œæ—¶å‚æ•°è¦†ç›–

### ğŸ”§ å®Œæ•´çš„åŸºç±»ä½“ç³»

é¡¹ç›®æä¾›äº†å®Œæ•´çš„åŸºç±»ä½“ç³»ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿæ‰©å±•ï¼š

- **AIStream** - å·¥ä½œæµåŸºç±»ï¼Œæä¾›AIè°ƒç”¨ã€è®°å¿†ã€åŠŸèƒ½ç®¡ç†
- **Plugin** - æ’ä»¶åŸºç±»ï¼Œæä¾›å·¥ä½œæµé›†æˆã€ä¸Šä¸‹æ–‡ç®¡ç†
- **HttpApi** - HTTP APIåŸºç±»ï¼Œæä¾›è·¯ç”±æ³¨å†Œã€WebSocketæ”¯æŒ
- **EventListener** - äº‹ä»¶ç›‘å¬åŸºç±»ï¼Œæä¾›äº‹ä»¶å¤„ç†èƒ½åŠ›
- **Renderer** - æ¸²æŸ“å™¨åŸºç±»ï¼Œæä¾›å›¾ç‰‡æ¸²æŸ“èƒ½åŠ›

**è¯¦ç»†æ–‡æ¡£ï¼š**
- [å·¥ä½œæµåŸºç±»å¼€å‘æ–‡æ¡£](./docs/WORKFLOW_BASE_CLASS.md)
- [æ’ä»¶åŸºç±»å¼€å‘æ–‡æ¡£](./docs/PLUGIN_BASE_CLASS.md)
- [HTTP APIåŸºç±»å¼€å‘æ–‡æ¡£](./docs/HTTP_API_BASE_CLASS.md)
- [é¡¹ç›®åŸºç±»æ€»è§ˆ](./docs/BASE_CLASSES.md)

### ğŸŒ ç°ä»£åŒ–HTTPæœåŠ¡å™¨

- **Expressæ¡†æ¶**ï¼šåŸºäºExpressçš„ç°ä»£åŒ–HTTPæœåŠ¡å™¨
- **WebSocketæ”¯æŒ**ï¼šå®Œæ•´çš„WebSocketæ”¯æŒï¼Œæ”¯æŒå®æ—¶é€šä¿¡
- **åå‘ä»£ç†**ï¼šæ”¯æŒå¤šåŸŸååå‘ä»£ç†ï¼Œè·¯å¾„é‡å†™ï¼Œè´Ÿè½½å‡è¡¡
- **HTTPSæ”¯æŒ**ï¼šæ”¯æŒHTTP/2å’Œç°ä»£TLSé…ç½®
- **å®‰å…¨ç‰¹æ€§**ï¼šCORSã€Helmetã€é€Ÿç‡é™åˆ¶ç­‰å®‰å…¨ç‰¹æ€§

### ğŸ“¦ æ’ä»¶ç³»ç»Ÿ

- **çƒ­é‡è½½**ï¼šæ”¯æŒæ’ä»¶çƒ­é‡è½½ï¼Œæ— éœ€é‡å¯
- **ä¼˜å…ˆçº§æ§åˆ¶**ï¼šçµæ´»çš„ä¼˜å…ˆçº§ç³»ç»Ÿ
- **æƒé™ç®¡ç†**ï¼šå®Œæ•´çš„æƒé™æ§åˆ¶ç³»ç»Ÿ
- **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šæ”¯æŒå¤šè½®å¯¹è¯å’ŒçŠ¶æ€ç®¡ç†

### ğŸ¨ æ¸²æŸ“ç³»ç»Ÿ

- **å¤šæ¸²æŸ“å™¨æ”¯æŒ**ï¼šæ”¯æŒPuppeteerå’ŒPlaywright
- **æ¨¡æ¿ç³»ç»Ÿ**ï¼šåŸºäºart-templateçš„æ¨¡æ¿ç³»ç»Ÿ
- **æ–‡ä»¶ç›‘å¬**ï¼šè‡ªåŠ¨ç›‘å¬æ¨¡æ¿æ–‡ä»¶å˜åŒ–

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows/Linux + Chrome/Chromium/Edge
- **Node.js**: >= 18.14.0
- **Redis**: >= 5.0.0
- **åŒ…ç®¡ç†å™¨**: pnpm (æ¨è) / npm / yarn

### å®‰è£…

```sh
# ä½¿ç”¨Gitcode
git clone --depth=1 https://gitcode.com/Xrkseek/XRK-Yunzai.git
cd XRK-Yunzai 

# ä½¿ç”¨Gitee
git clone --depth=1 https://gitee.com/xrkseek/XRK-Yunzai.git
cd XRK-Yunzai 

# ä½¿ç”¨Github
git clone --depth=1 https://github.com/Xrkseek/XRK-Yunzai.git
cd XRK-Yunzai 
```

### è¿è¡Œ

```sh
node app
```

é¦–æ¬¡è¿è¡ŒæŒ‰æç¤ºè¾“å…¥ç™»å½•ä¿¡æ¯ã€‚

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ

```sh
# 1. å®‰è£…ä¾èµ–ï¼ˆè‡ªåŠ¨ï¼‰
node app

# 2. é¦–æ¬¡è¿è¡Œä¼šæç¤ºç™»å½•
# 3. ç™»å½•æˆåŠŸåå³å¯ä½¿ç”¨
```

### æ–¹å¼äºŒï¼šDockeréƒ¨ç½²

#### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```sh
# 1. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# 2. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f xrk-yunzai

# 3. åœæ­¢æœåŠ¡
docker-compose down
```

#### ä½¿ç”¨ Dockerfile

```sh
# 1. æ„å»ºé•œåƒ
docker build -t xrk-yunzai:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name xrk-yunzai \
  -p 3000:3000 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/config:/app/config \
  -v $(pwd)/plugins:/app/plugins \
  xrk-yunzai:latest

# 3. æŸ¥çœ‹æ—¥å¿—
docker logs -f xrk-yunzai
```

**æ³¨æ„äº‹é¡¹ï¼š**
- ç¡®ä¿ `data/`ã€`config/`ã€`plugins/` ç›®å½•å­˜åœ¨
- é¦–æ¬¡è¿è¡Œéœ€è¦ç™»å½•ï¼Œå»ºè®®å…ˆæœ¬åœ°è¿è¡Œå®Œæˆç™»å½•åå†ä½¿ç”¨Docker
- Redisæ•°æ®ä¼šæŒä¹…åŒ–åˆ° `redis-data` volume

### æ–¹å¼ä¸‰ï¼šPM2éƒ¨ç½²

```sh
# 1. å…¨å±€å®‰è£…PM2
npm install -g pm2

# 2. å¯åŠ¨åº”ç”¨
pm2 start app.js --name xrk-yunzai

# 3. æŸ¥çœ‹çŠ¶æ€
pm2 status

# 4. æŸ¥çœ‹æ—¥å¿—
pm2 logs xrk-yunzai

# 5. åœæ­¢åº”ç”¨
pm2 stop xrk-yunzai
```

## é¡¹ç›®ç»“æ„

```
XRK-Yunzai/
â”œâ”€â”€ app.js                 # åº”ç”¨å…¥å£ï¼ˆä¾èµ–æ£€æŸ¥å’Œå¼•å¯¼ï¼‰
â”œâ”€â”€ start.js              # ä¸»å¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ package.json          # é¡¹ç›®é…ç½®
â”œâ”€â”€ docker-compose.yml    # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile            # Dockeré•œåƒé…ç½®
â”‚
â”œâ”€â”€ lib/                  # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ bot.js           # Botä¸»ç±»ï¼ˆHTTPæœåŠ¡å™¨ã€WebSocketã€æ’ä»¶ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ aistream/        # å·¥ä½œæµæ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ aistream.js  # å·¥ä½œæµåŸºç±»
â”‚   â”‚   â”œâ”€â”€ memory.js    # è®°å¿†ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ workflow-manager.js  # å¤šå·¥ä½œæµç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ loader.js    # å·¥ä½œæµåŠ è½½å™¨
â”‚   â”œâ”€â”€ plugins/         # æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ plugin.js    # æ’ä»¶åŸºç±»
â”‚   â”‚   â””â”€â”€ loader.js    # æ’ä»¶åŠ è½½å™¨
â”‚   â”œâ”€â”€ http/            # HTTP APIç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ http.js      # HTTP APIåŸºç±»
â”‚   â”‚   â””â”€â”€ loader.js    # APIåŠ è½½å™¨
â”‚   â”œâ”€â”€ listener/        # äº‹ä»¶ç›‘å¬ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ listener.js  # äº‹ä»¶ç›‘å¬åŸºç±»
â”‚   â”‚   â””â”€â”€ loader.js    # ç›‘å¬å™¨åŠ è½½å™¨
â”‚   â”œâ”€â”€ renderer/        # æ¸²æŸ“å™¨ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Renderer.js  # æ¸²æŸ“å™¨åŸºç±»
â”‚   â”‚   â””â”€â”€ loader.js    # æ¸²æŸ“å™¨åŠ è½½å™¨
â”‚   â”œâ”€â”€ config/          # é…ç½®ç³»ç»Ÿ
â”‚   â”œâ”€â”€ common/          # é€šç”¨å·¥å…·
â”‚   â””â”€â”€ modules/         # æ¨¡å—ï¼ˆoicqç­‰ï¼‰
â”‚
â”œâ”€â”€ plugins/              # æ’ä»¶ç›®å½•
â”‚   â”œâ”€â”€ stream/          # å·¥ä½œæµæ’ä»¶
â”‚   â”‚   â”œâ”€â”€ chat.js      # èŠå¤©å·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ device.js    # è®¾å¤‡å·¥ä½œæµ
â”‚   â”œâ”€â”€ api/             # APIè·¯ç”±æ’ä»¶
â”‚   â”œâ”€â”€ events/          # äº‹ä»¶å¤„ç†æ’ä»¶
â”‚   â”œâ”€â”€ adapter/         # é€‚é…å™¨æ’ä»¶
â”‚   â””â”€â”€ system/          # ç³»ç»Ÿæ’ä»¶
â”‚
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ default_config/  # é»˜è®¤é…ç½®
â”‚   â”‚   â”œâ”€â”€ kuizai.yaml  # AIé…ç½®
â”‚   â”‚   â”œâ”€â”€ bot.yaml     # Boté…ç½®
â”‚   â”‚   â””â”€â”€ server.yaml   # æœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ server_config/   # æœåŠ¡å™¨é…ç½®ï¼ˆç™»å½•ä¿¡æ¯ç­‰ï¼‰
â”‚
â”œâ”€â”€ data/                # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ bots/           # Botæ•°æ®ï¼ˆç™»å½•ä¿¡æ¯ï¼‰
â”‚   â”œâ”€â”€ wav/            # éŸ³é¢‘æ–‡ä»¶
â”‚   â””â”€â”€ models/         # æ¨¡å‹æ–‡ä»¶
â”‚
â”œâ”€â”€ www/                 # é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ xrk/            # å‰ç«¯ç•Œé¢
â”‚
â”œâ”€â”€ renderers/           # æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ puppeteer/      # Puppeteeræ¸²æŸ“å™¨
â”‚   â””â”€â”€ playwright/     # Playwrightæ¸²æŸ“å™¨
â”‚
â””â”€â”€ docs/                # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ WORKFLOW_BASE_CLASS.md  # å·¥ä½œæµåŸºç±»æ–‡æ¡£
    â”œâ”€â”€ PLUGIN_BASE_CLASS.md    # æ’ä»¶åŸºç±»æ–‡æ¡£
    â”œâ”€â”€ HTTP_API_BASE_CLASS.md  # HTTP APIåŸºç±»æ–‡æ¡£
    â””â”€â”€ BASE_CLASSES.md         # é¡¹ç›®åŸºç±»æ€»è§ˆ
```

## é…ç½®è¯´æ˜

### AIé…ç½®

é…ç½®æ–‡ä»¶ï¼š`config/default_config/kuizai.yaml`

```yaml
kuizai:
  ai:
    enabled: true
    baseUrl: 'https://api.gptgod.online/v1'
    apiKey: 'your-api-key'
    chatModel: 'deepseek-r1-0528'
    temperature: 0.8
    max_tokens: 2000
    
  responsePolish:
    enabled: true
    maxTokens: 400
    temperature: 0.3
    
  reasoning:
    enabled: false
    maxIterations: 3
    temperature: 0.8
    
  workflows:
    enabled: true
    allowMultiple: true
    defaultWorkflow: 'device'
```

### æœåŠ¡å™¨é…ç½®

é…ç½®æ–‡ä»¶ï¼š`config/default_config/server.yaml`

ä¸»è¦é…ç½®é¡¹ï¼š
- `server.host`: ç›‘å¬åœ°å€ï¼ˆé»˜è®¤0.0.0.0ï¼‰
- `server.url`: å¤–éƒ¨è®¿é—®URL
- `proxy.enabled`: æ˜¯å¦å¯ç”¨åå‘ä»£ç†
- `https.enabled`: æ˜¯å¦å¯ç”¨HTTPS

## å¼€å‘æ–‡æ¡£

### åŸºç±»æ–‡æ¡£

- [å·¥ä½œæµåŸºç±»å¼€å‘æ–‡æ¡£](./docs/WORKFLOW_BASE_CLASS.md) - å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰å·¥ä½œæµ
- [æ’ä»¶åŸºç±»å¼€å‘æ–‡æ¡£](./docs/PLUGIN_BASE_CLASS.md) - å¦‚ä½•åˆ›å»ºæ’ä»¶
- [HTTP APIåŸºç±»å¼€å‘æ–‡æ¡£](./docs/HTTP_API_BASE_CLASS.md) - å¦‚ä½•åˆ›å»ºAPIè·¯ç”±
- [é¡¹ç›®åŸºç±»æ€»è§ˆ](./docs/BASE_CLASSES.md) - æ‰€æœ‰åŸºç±»çš„æ¦‚è§ˆ

### å…¶ä»–æ–‡æ¡£

- [è‘µå´½é‡è¦ç‰¹æ€§](./stdin.md) - ç”¨æˆ·åŠŸèƒ½è¯´æ˜

## å¿«é€Ÿç¤ºä¾‹

### åˆ›å»ºæ’ä»¶

```javascript
// plugins/my-plugin.js
import plugin from '../../lib/plugins/plugin.js';

export default class MyPlugin extends plugin {
  constructor() {
    super({
      name: 'my-plugin',
      dsc: 'æˆ‘çš„æ’ä»¶',
      event: 'message',
      rule: [
        { reg: '^#æµ‹è¯•$', fnc: 'test' }
      ]
    });
  }

  async test(e) {
    // è°ƒç”¨å·¥ä½œæµ
    const result = await this.callWorkflow('chat', {
      question: e.msg
    }, { e });
    
    return this.reply(result.content);
  }
}
```

### åˆ›å»ºAPI

```javascript
// plugins/api/my-api.js
export default {
  name: 'my-api',
  dsc: 'æˆ‘çš„API',
  routes: [
    {
      method: 'GET',
      path: '/api/test',
      handler: async (req, res, Bot) => {
        res.json({ success: true });
      }
    }
  ]
};
```

### åˆ›å»ºå·¥ä½œæµ

```javascript
// plugins/stream/my-workflow.js
import AIStream from '../../lib/aistream/aistream.js';

export default class MyWorkflow extends AIStream {
  constructor() {
    super({
      name: 'my-workflow',
      description: 'æˆ‘çš„å·¥ä½œæµ'
    });
  }

  buildSystemPrompt(context) {
    return 'ç³»ç»Ÿæç¤º';
  }

  async buildChatContext(e, question) {
    return [
      { role: 'system', content: this.buildSystemPrompt({ e, question }) },
      { role: 'user', content: question }
    ];
  }
}
```

## åç»­è®¡åˆ’

- âœ… pm2å¯åŠ¨æ–¹å¼
- âœ… å¼€æºå¯¹æ¥ä»»åŠ¡å¤„ç†å™¨
- âœ… æŠ•å…¥å†œä¸šå®è·µä½¿ç”¨
- âœ… å®Œå–„ä»»åŠ¡å¤„ç†é€»è¾‘
- ğŸ”„ å°†icqqç­‰ç›¸å…³åº•å±‚å‰¥ç¦»
- ğŸ”„ ç±»å‹æ‰©å±•å’Œå¼€å‘è§„èŒƒåŒ–

## è‡´è°¢

| Nickname | name | Contribution |
|:--------:|------|--------------|
| [Yunzai v3.0](https://gitee.com/le-niao/Yunzai-Bot) | ä¹ç¥çš„Yunzai-Bot V3 | å…ƒè€çº§é¡¹ç›® |
| [Miao-Yunzai v3.1.3](https://gitee.com/yoimiya-kokomi/Miao-Yunzai) | å–µå–µçš„Miao-Yunzai | é¡¹ç›®åŸºç¡€ï¼Œæä¾›äº†ä¼˜åŒ–æ–¹å‘å’ŒåŸç¥åŠŸèƒ½é€‚é… |
| [TRSS-Yunzai v3.1.3](https://gitee.com/TimeRainStarSky/Yunzai) | æ—¶é›¨çš„Yunzai | ä¸ºè‘µå´½åº•å±‚è®¾è®¡æä¾›äº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ï¼Œæ—¶é›¨å´½æ˜¯å½“ä¹‹æ— æ„§çš„nodeé¡¹ç›®çš„è‰ºæœ¯å“ |
