# ----------------------------------------
#            基础配置
# ----------------------------------------
server:
  # 服务器名称（将显示在日志中）
  name: "XRK Server"
  
  # 监听地址
  # - 0.0.0.0: 监听所有网络接口（允许外部访问）
  # - 127.0.0.1: 仅监听本地（仅本机可访问）
  host: "0.0.0.0"
  
  # 外部访问URL（可选）
  # 用于生成完整的访问链接，留空则自动检测
  # 示例: https://bot.example.com
  url: ""

# ----------------------------------------
#          反向代理配置
# ----------------------------------------
proxy:
  # 是否启用反向代理功能
  enabled: false
  
  # HTTP监听端口（作为反向代理时建议使用80）
  httpPort: 80
  
  # HTTPS监听端口（作为反向代理时建议使用443）
  httpsPort: 443
  
  # 健康检查配置（用于负载均衡和故障转移）
  healthCheck:
    enabled: false
    interval: 30000
    maxFailures: 3
    timeout: 5000
    cacheTime: 5000
  
  # 域名配置列表
  domains: []
    # 主域名配置示例（已注释，需要时取消注释并添加到domains数组中）
    # - domain: "xrkk.cc"
    #   # 静态文件根目录（可选）
    #   # 如果不配置，使用默认的www目录
    #   staticRoot: "./www"
    #   
    #   # 是否启用SSL（需要配置证书）
    #   ssl:
    #     enabled: true
    #     certificate:
    #       # 域名专用证书路径
    #       key: "/path/to/xrkk.cc.key"
    #       cert: "/path/to/xrkk.cc.cert"
    #       ca: ""  # CA证书链（可选）
    #   
    #   # 目标服务器（如果需要代理到其他服务）
    #   # 不配置则直接提供静态文件服务
    #   # target: "http://localhost:3000"
    #     
    #   # 路径重写规则（可选）
    #   # rewritePath:
    #   #   from: "/"
    #   #   to: "/"
    
    # 子域名配置示例（已注释）
    # - domain: "xrk.xrkk.cc"
    #   # 子域名专用的静态文件目录
    #   staticRoot: "./www/xrk"
    #   
    #   # SSL配置（每个域名可以有自己的证书）
    #   ssl:
    #     enabled: true
    #     certificate:
    #       key: "/path/to/xrk.xrkk.cc.key"
    #       cert: "/path/to/xrk.xrkk.cc.cert"
    #   
    #   # 路径重写：将 /xrk/* 重写为 /*
    #   # 使得xrk.xrkk.cc/index.html 等同于访问原本的 /xrk/index.html
    #   rewritePath:
    #     from: "/xrk"
    #     to: "/"
    #   
    #   # 自定义请求和响应头（可选）
    #   headers:
    #     request:
    #       # 添加到代理请求的头部
    #       X-Custom-Header: "xrk-subdomain"
    #     response:
    #       # 添加到响应的头部
    #       X-Frame-Options: "SAMEORIGIN"
    
    # API子域名示例（反向代理到后端服务）
    #- domain: "api.xrkk.cc"
    # 代理到后端API服务
    #  target: "http://localhost:8080"
    #  
    #  ssl:
    #    enabled: true
    #    certificate:
    #      key: "/path/to/api.xrkk.cc.key"
    #      cert: "/path/to/api.xrkk.cc.cert"
    #  
    # 保持原始Host头（某些后端服务需要）
    #  preserveHostHeader: true
      
    # WebSocket支持
    #  ws: true
      
    # 超时设置（毫秒）
    #  timeout: 30000
      
    # 更复杂的路径重写规则
    #  pathRewrite:
    #    "^/v1": "/api/v1"
    #    "^/v2": "/api/v2"
    #    "^/legacy": ""
    
    # 通配符域名示例（处理所有子域名）
    #- domain: "*.test.xrkk.cc"
    # 所有 *.test.xrkk.cc 的请求都代理到这里
    #  target: "http://localhost:9000"
      
    # 通配符证书
    #  ssl:
    #    enabled: true
    #    certificate:
    #      key: "/path/to/wildcard.test.xrkk.cc.key"
    #      cert: "/path/to/wildcard.test.xrkk.cc.cert"
      
    # 动态路径重写（基于子域名）
    # 例如：dev.test.xrkk.cc → http://localhost:9000/dev
    # 例如：staging.test.xrkk.cc → http://localhost:9000/staging
    #  rewritePath:
    #    from: "/"
    #    to: "/${subdomain}/"  # ${subdomain}会被实际子域名替换
    
    # 负载均衡示例（轮询多个后端服务器）
    #- domain: "lb.xrkk.cc"
    #  # 多个目标服务器（支持负载均衡）
    #  target:
    #    - url: "http://localhost:3001"
    #      weight: 3  # 权重：3
    #      healthUrl: "http://localhost:3001/health"  # 自定义健康检查URL
    #    - url: "http://localhost:3002"
    #      weight: 1  # 权重：1
    #      healthUrl: "http://localhost:3002/health"
    #  # 负载均衡算法（可选）
    #  # 支持：round-robin（轮询）、weighted（加权轮询）、least-connections（最少连接）、
    #  #      ip-hash（IP哈希）、consistent-hash（一致性哈希）、least-response-time（最少响应时间）
    #  loadBalance: "weighted"  # 默认：round-robin
      
    # 健康检查配置（可选，已在全局配置中设置）
    #  healthCheck:
    #    enabled: true
    #    path: "/health"  # 健康检查路径
    #    interval: 30000  # 检查间隔（毫秒）
    #    timeout: 5000    # 超时时间（毫秒）
    #    maxFailures: 3   # 最大失败次数
    #    cacheTime: 5000  # 结果缓存时间（毫秒）

# ----------------------------------------
#            HTTPS配置
# ----------------------------------------
https:
  # 是否启用HTTPS服务（全局默认证书）
  # 注意：现在每个域名可以有自己的证书
  enabled: false
  
  # 默认SSL证书配置（当域名没有配置专用证书时使用）
  certificate:
    # 私钥文件路径（可选）
    key: ""
    
    # 证书文件路径（可选）
    cert: ""
    
    # CA证书链文件路径（可选）
    ca: ""
  
  # TLS配置
  tls:
    # 最低TLS版本（建议不低于TLSv1.2）
    minVersion: "TLSv1.2"
    
    # 是否启用HTTP/2协议（提升性能）
    http2: true
  
  # HSTS（HTTP严格传输安全）配置
  # 警告：启用后所有HTTP请求将强制重定向到HTTPS
  hsts:
    enabled: false
    # 有效期（秒），31536000 = 1年
    maxAge: 31536000
    # 是否包含子域名
    includeSubDomains: true
    # 是否允许预加载（需要提交到浏览器预加载列表）
    preload: false

# ----------------------------------------
#            静态文件服务
# ----------------------------------------
static:
  # 默认首页文件列表
  index:
    - "index.html"
    - "index.htm"
    - "default.html"
  
  # 是否允许自动添加扩展名
  extensions: false
  
  # 缓存时间设置
  cache:
    static: 86400     # CSS/JS文件
    images: 604800    # 图片文件
  cacheTime: "1d"

# ----------------------------------------
#            安全配置
# ----------------------------------------
security:
  # Helmet安全头配置
  # 自动添加安全相关的HTTP头部
  helmet:
    enabled: true
  
  # HSTS配置（需要HTTPS启用）
  hsts:
    enabled: false
    maxAge: 31536000
    includeSubDomains: true
    preload: false
  
  # 隐藏文件/目录模式
  # 匹配这些模式的文件将返回404
  hiddenFiles:
    - "^\\..*"        # 所有点开头的文件
    - "node_modules"  # Node.js依赖目录
    - "\\.git"        # Git版本控制目录
    - "\\.env"        # 环境变量文件
    - "config/"       # 配置目录
    - "private/"      # 私有目录

# ----------------------------------------
#         跨域资源共享（CORS）
# ----------------------------------------
cors:
  # 是否启用CORS
  enabled: true
  
  # 允许的来源
  # - "*": 允许所有来源（不安全）
  # - 具体域名列表: ["https://example.com", "https://xrkk.cc"]
  origins: ["*"]
  
  # 允许的HTTP方法
  methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  
  # 允许的请求头
  headers: ["Content-Type", "Authorization", "X-API-Key"]
  
  # 是否允许携带凭证（cookies等）
  credentials: false
  
  # 预检请求缓存时间（秒）
  maxAge: 86400

# ----------------------------------------
#            认证配置
# ----------------------------------------
auth:
  # API密钥配置
  apiKey:
    # 是否启用API密钥认证
    enabled: true
    
    # 密钥存储文件路径
    file: "config/server_config/api_key.json"
    
    # 密钥长度（字符数）
    length: 64
  
  # 无需认证的路径（白名单）
  # 这些路径可以直接访问
  whitelist:
    - "/"              # 根目录
    - "/favicon.ico"   # 网站图标
    - "/health"        # 健康检查
    - "/status"        # 状态接口
    - "/robots.txt"    # 爬虫规则
    - "/xrk"           # 葵崽的API接口测试页面
    - "/media/*"       # 媒体文件目录
    - "/uploads/*"     # 上传文件目录
    # 注意：静态文件默认允许访问

# ----------------------------------------
#            速率限制
# ----------------------------------------
rateLimit:
  # 是否启用速率限制（防止恶意请求）
  enabled: true
  
  # 全局限制（所有请求）
  global:
    windowMs: 900000  # 时间窗口：15分钟
    max: 1000         # 最大请求数
    message: "请求过于频繁，请稍后再试"
  
  # API接口限制（更严格）
  api:
    windowMs: 60000   # 时间窗口：1分钟
    max: 60           # 最大请求数
    message: "API请求过于频繁"

# ----------------------------------------
#            请求限制
# ----------------------------------------
limits:
  # 各种请求体大小限制
  urlencoded: "10mb"  # URL编码数据
  json: "10mb"        # JSON数据
  raw: "50mb"         # 原始数据
  text: "10mb"        # 文本数据
  fileSize: "100mb"   # 文件上传

# ----------------------------------------
#            压缩配置
# ----------------------------------------
compression:
  # 是否启用响应压缩（减少带宽使用）
  enabled: true
  
  # 压缩级别（0-9）
  # 0: 无压缩（最快）
  # 9: 最大压缩（最慢）
  # 推荐：6（平衡）
  level: 6
  
  # 最小压缩大小（字节）
  # 小于此大小的响应不会被压缩
  threshold: 1024

# ----------------------------------------
#            日志配置
# ----------------------------------------
logging:
  requests: true
  errors: true
  debug: false
  quiet:
    - "/health"
    - "/favicon.ico"
    - "/robots.txt"

# ----------------------------------------
#          HTTP重定向配置
# ----------------------------------------
# HTTP重定向规则配置
# 支持多种重定向类型：301(永久), 302(临时), 307(临时保持方法), 308(永久保持方法)
redirects: []
  # 重定向规则示例（已注释，需要时取消注释并添加到redirects数组中）
  # - from: "/old-path"
  #   to: "/new-path"
  #   status: 301  # 301永久重定向
  #   preserveQuery: true  # 保留查询参数
  #   preservePath: false  # 不保留路径变量
  #
  # - from: "/old/*"
  #   to: "/new/$1"  # 使用$1引用通配符匹配的内容
  #   status: 302  # 302临时重定向
  #
  # - from: "/legacy"
  #   to: "https://example.com/new"  # 重定向到外部URL
  #   status: 301
  #
  # - from: "/api/v1/*"
  #   to: "/api/v2/$1"  # API版本升级重定向
  #   status: 301
  #   condition: "req.headers['user-agent'].includes('old-client')"  # 条件重定向

# ----------------------------------------
#          CDN配置
# ----------------------------------------
# CDN（内容分发网络）配置
# 用于静态资源CDN回源、缓存控制、CDN头部处理
cdn:
  # 是否启用CDN功能
  enabled: false
  
  # CDN域名（用于生成CDN URL）
  # 示例: "cdn.example.com"
  domain: ""
  
  # 静态资源前缀（只有匹配此前缀的路径才会使用CDN）
  staticPrefix: "/static"
  
  # CDN是否使用HTTPS
  https: true
  
  # 缓存控制配置（秒）
  cacheControl:
    static: 31536000   # CSS/JS/字体等静态资源：1年
    images: 604800     # 图片资源：7天
    default: 3600      # 其他资源：1小时
  
  # CDN识别模式（自动检测主流CDN）
  # 支持的CDN：Cloudflare、阿里云CDN、腾讯云CDN、AWS CloudFront、百度云CDN、七牛云、UCloud等

# ----------------------------------------
#          性能优化配置
# ----------------------------------------
performance:
  keepAlive:
    enabled: true
    initialDelay: 1000
    timeout: 120000
  http2Push:
    enabled: false
    criticalAssets:
      - "/static/css/main.css"
      - "/static/js/main.js"
  connectionPool:
    maxSockets: 50
    maxFreeSockets: 10
    timeout: 30000

# ----------------------------------------
#            其他配置
# ----------------------------------------
misc:
  # 是否自动检测公网IP
  # 用于显示外网访问地址
  detectPublicIP: true
  
  # 404时的默认重定向路径
  defaultRoute: "/"