# ----------------------------------------
#            基础配置
# ----------------------------------------
server:
  # name: 服务器名称（将显示在日志中）
  name: "XRK Server"
  # host: 监听地址；0.0.0.0=所有网卡，127.0.0.1=仅本机
  host: "0.0.0.0"
  # url: 外部访问 URL（可选），留空则自动检测；示例 https://bot.example.com
  url: ""

# ----------------------------------------
#          反向代理配置
# ----------------------------------------
proxy:
  # enabled: 是否启用反向代理功能
  enabled: false
  # httpPort: HTTP 监听端口（反向代理时建议 80）
  httpPort: 80
  # httpsPort: HTTPS 监听端口（反向代理时建议 443）
  httpsPort: 443
  
  # 健康检查配置（用于负载均衡和故障转移）
  healthCheck:
    # enabled: 是否启用健康检查
    enabled: false
    # interval: 检查间隔（毫秒）
    interval: 30000
    # maxFailures: 最大连续失败次数
    maxFailures: 3
    # timeout: 单次检查超时（毫秒）
    timeout: 5000
    # cacheTime: 结果缓存时间（毫秒）
    cacheTime: 5000
  
  # domains: 域名配置列表，每项可含 domain、ssl、target、rewritePath 等
  domains: []
    # 主域名配置示例（已注释，需要时取消注释并添加到domains数组中）
    # - domain: "xrkk.cc"
    #   # 静态文件根目录（可选）
    #   # 如果不配置，使用默认的www目录
    #   staticRoot: "./www"
    #   
    #   # 是否启用SSL（需要配置证书）
    #   ssl:
    #     enabled: true
    #     certificate:
    #       # 域名专用证书路径
    #       key: "/path/to/xrkk.cc.key"
    #       cert: "/path/to/xrkk.cc.cert"
    #       ca: ""  # CA证书链（可选）
    #   
    #   # 目标服务器（如果需要代理到其他服务）
    #   # 不配置则直接提供静态文件服务
    #   # target: "http://localhost:3000"
    #     
    #   # 路径重写规则（可选）
    #   # rewritePath:
    #   #   from: "/"
    #   #   to: "/"
    
    # 子域名配置示例（已注释）
    # - domain: "xrk.xrkk.cc"
    #   # 子域名专用的静态文件目录
    #   staticRoot: "./www/xrk"
    #   
    #   # SSL配置（每个域名可以有自己的证书）
    #   ssl:
    #     enabled: true
    #     certificate:
    #       key: "/path/to/xrk.xrkk.cc.key"
    #       cert: "/path/to/xrk.xrkk.cc.cert"
    #   
    #   # 路径重写：将 /xrk/* 重写为 /*
    #   # 使得xrk.xrkk.cc/index.html 等同于访问原本的 /xrk/index.html
    #   rewritePath:
    #     from: "/xrk"
    #     to: "/"
    #   
    #   # 自定义请求和响应头（可选）
    #   headers:
    #     request:
    #       # 添加到代理请求的头部
    #       X-Custom-Header: "xrk-subdomain"
    #     response:
    #       # 添加到响应的头部
    #       X-Frame-Options: "SAMEORIGIN"
    
    # API子域名示例（反向代理到后端服务）
    #- domain: "api.xrkk.cc"
    # 代理到后端API服务
    #  target: "http://localhost:8080"
    #  
    #  ssl:
    #    enabled: true
    #    certificate:
    #      key: "/path/to/api.xrkk.cc.key"
    #      cert: "/path/to/api.xrkk.cc.cert"
    #  
    # 保持原始Host头（某些后端服务需要）
    #  preserveHostHeader: true
      
    # WebSocket支持
    #  ws: true
      
    # 超时设置（毫秒）
    #  timeout: 30000
      
    # 更复杂的路径重写规则
    #  pathRewrite:
    #    "^/v1": "/api/v1"
    #    "^/v2": "/api/v2"
    #    "^/legacy": ""
    
    # 通配符域名示例（处理所有子域名）
    #- domain: "*.test.xrkk.cc"
    # 所有 *.test.xrkk.cc 的请求都代理到这里
    #  target: "http://localhost:9000"
      
    # 通配符证书
    #  ssl:
    #    enabled: true
    #    certificate:
    #      key: "/path/to/wildcard.test.xrkk.cc.key"
    #      cert: "/path/to/wildcard.test.xrkk.cc.cert"
      
    # 动态路径重写（基于子域名）
    # 例如：dev.test.xrkk.cc → http://localhost:9000/dev
    # 例如：staging.test.xrkk.cc → http://localhost:9000/staging
    #  rewritePath:
    #    from: "/"
    #    to: "/${subdomain}/"  # ${subdomain}会被实际子域名替换
    
    # 负载均衡示例（轮询多个后端服务器）
    #- domain: "lb.xrkk.cc"
    #  # 多个目标服务器（支持负载均衡）
    #  target:
    #    - url: "http://localhost:3001"
    #      weight: 3  # 权重：3
    #      healthUrl: "http://localhost:3001/health"  # 自定义健康检查URL
    #    - url: "http://localhost:3002"
    #      weight: 1  # 权重：1
    #      healthUrl: "http://localhost:3002/health"
    #  # 负载均衡算法（可选）
    #  # 支持：round-robin（轮询）、weighted（加权轮询）、least-connections（最少连接）、
    #  #      ip-hash（IP哈希）、consistent-hash（一致性哈希）、least-response-time（最少响应时间）
    #  loadBalance: "weighted"  # 默认：round-robin
      
    # 健康检查配置（可选，已在全局配置中设置）
    #  healthCheck:
    #    enabled: true
    #    path: "/health"  # 健康检查路径
    #    interval: 30000  # 检查间隔（毫秒）
    #    timeout: 5000    # 超时时间（毫秒）
    #    maxFailures: 3   # 最大失败次数
    #    cacheTime: 5000  # 结果缓存时间（毫秒）

# ----------------------------------------
#            HTTPS配置
# ----------------------------------------
https:
  # enabled: 是否启用 HTTPS（全局默认证书）；各域名可单独配置证书
  enabled: false
  # certificate: 默认 SSL 证书（域名未配置专用证书时使用）
  certificate:
    # key: 私钥文件路径
    key: ""
    # cert: 证书文件路径
    cert: ""
    # ca: CA 证书链文件路径（可选）
    ca: ""
  # tls: TLS 协议配置
  tls:
    # minVersion: 最低 TLS 版本，建议不低于 TLSv1.2
    minVersion: "TLSv1.2"
    # http2: 是否启用 HTTP/2
    http2: true
  # hsts: HTTP 严格传输安全；启用后 HTTP 将强制跳转 HTTPS
  hsts:
    # enabled: 是否启用 HSTS
    enabled: false
    # maxAge: 有效期（秒），31536000 = 1 年
    maxAge: 31536000
    # includeSubDomains: 是否包含子域名
    includeSubDomains: true
    # preload: 是否允许预加载
    preload: false

# ----------------------------------------
#            静态文件服务
# ----------------------------------------
static:
  # index: 默认首页文件名列表，按顺序尝试
  index:
    - "index.html"
    - "index.htm"
    - "default.html"
  # extensions: 是否允许自动添加扩展名
  extensions: false
  
  # 缓存时间设置
  cache:
    # static: CSS/JS 等静态资源缓存时间（秒）
    static: 86400
    # images: 图片资源缓存时间（秒）
    images: 604800
  # cacheTime: 默认缓存时长，如 "1d"
  cacheTime: "1d"

# ----------------------------------------
#            安全配置
# ----------------------------------------
security:
  # Helmet安全头配置（自动添加安全相关的 HTTP 头部）
  helmet:
    # enabled: 是否启用 Helmet
    enabled: true
  # HSTS 配置（需要 HTTPS 启用）
  hsts:
    # enabled: 是否启用 HSTS
    enabled: false
    # maxAge: 有效期（秒），31536000 = 1 年
    maxAge: 31536000
    # includeSubDomains: 是否包含子域名
    includeSubDomains: true
    # preload: 是否允许预加载
    preload: false
  
  # hiddenFiles: 匹配这些模式的文件或目录将返回 404（正则或片段）
  hiddenFiles:
    - "^\\..*"
    - "node_modules"
    - "\\.git"
    - "\\.env"
    - "config/"
    - "private/"

# ----------------------------------------
#         跨域资源共享（CORS）
# ----------------------------------------
cors:
  # enabled: 是否启用 CORS
  enabled: true
  # origins: 允许的来源，* 表示全部（不安全）
  origins: ["*"]
  # methods: 允许的 HTTP 方法
  methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  # headers: 允许的请求头
  headers: ["Content-Type", "Authorization", "X-API-Key"]
  # credentials: 是否允许携带凭证（cookies 等）
  credentials: false
  # maxAge: 预检请求缓存时间（秒）
  maxAge: 86400

# ----------------------------------------
#            认证配置
# ----------------------------------------
auth:
  # apiKey: API 密钥认证配置
  apiKey:
    # enabled: 是否启用 API 密钥认证
    enabled: true
    # file: 密钥存储文件路径
    file: "config/server_config/api_key.json"
    # length: 密钥长度（字符数）
    length: 64
  # whitelist: 无需认证的路径列表，可直接访问
  whitelist:
    - "/"              # 根目录
    - "/favicon.ico"   # 网站图标
    - "/health"        # 健康检查
    - "/status"        # 状态接口
    - "/robots.txt"    # 爬虫规则
    - "/xrk"           # 葵崽的API接口测试页面
    - "/media/*"       # 媒体文件目录
    - "/uploads/*"     # 上传文件目录
    - "/device"        # 控制台 WebSocket 设备连接
    # 注意：静态文件默认允许访问

# ----------------------------------------
#            速率限制
# ----------------------------------------
rateLimit:
  # enabled: 是否启用速率限制（防止恶意请求）
  enabled: true
  
  # 全局限制（所有请求）
  global:
    # windowMs: 时间窗口（毫秒），900000 = 15 分钟
    windowMs: 900000
    # max: 窗口内最大请求数
    max: 1000
    # message: 触发限制时的提示文案
    message: "请求过于频繁，请稍后再试"
  # API 接口限制（更严格）
  api:
    # windowMs: 时间窗口（毫秒），60000 = 1 分钟
    windowMs: 60000
    # max: 窗口内最大请求数
    max: 60
    # message: 触发限制时的提示文案
    message: "API请求过于频繁"

# ----------------------------------------
#            请求限制
# ----------------------------------------
limits:
  # urlencoded: URL 编码请求体大小限制
  urlencoded: "10mb"
  # json: JSON 请求体大小限制
  json: "10mb"
  # raw: 原始请求体大小限制
  raw: "50mb"
  # text: 文本请求体大小限制
  text: "10mb"
  # fileSize: 单文件上传大小限制
  fileSize: "100mb"

# ----------------------------------------
#            压缩配置
# ----------------------------------------
compression:
  # enabled: 是否启用响应压缩
  enabled: true
  # level: 压缩级别 0～9，0 最快 9 最小体积，推荐 6
  level: 6
  # threshold: 最小压缩大小（字节），小于此值不压缩
  threshold: 1024

# ----------------------------------------
#            日志配置
# ----------------------------------------
logging:
  # requests: 是否记录请求日志
  requests: true
  # errors: 是否记录错误日志
  errors: true
  # debug: 是否输出调试日志
  debug: false
  # quiet: 不记录日志的路径列表
  quiet:
    - "/health"
    - "/favicon.ico"
    - "/robots.txt"

# ----------------------------------------
#          HTTP重定向配置
# ----------------------------------------
# HTTP 重定向规则配置；支持 301/302/307/308
# redirects: 重定向规则列表，每项含 from、to、status 等
redirects: []
  # 重定向规则示例（已注释，需要时取消注释并添加到redirects数组中）
  # - from: "/old-path"
  #   to: "/new-path"
  #   status: 301  # 301永久重定向
  #   preserveQuery: true  # 保留查询参数
  #   preservePath: false  # 不保留路径变量
  #
  # - from: "/old/*"
  #   to: "/new/$1"  # 使用$1引用通配符匹配的内容
  #   status: 302  # 302临时重定向
  #
  # - from: "/legacy"
  #   to: "https://example.com/new"  # 重定向到外部URL
  #   status: 301
  #
  # - from: "/api/v1/*"
  #   to: "/api/v2/$1"  # API版本升级重定向
  #   status: 301
  #   condition: "req.headers['user-agent'].includes('old-client')"  # 条件重定向

# ----------------------------------------
#          CDN配置
# ----------------------------------------
# CDN（内容分发网络）配置
# 用于静态资源CDN回源、缓存控制、CDN头部处理
cdn:
  # enabled: 是否启用 CDN 功能
  enabled: false
  # domain: CDN 域名，用于生成 CDN URL
  domain: ""
  # staticPrefix: 仅匹配此前缀的路径使用 CDN
  staticPrefix: "/static"
  # https: CDN 是否使用 HTTPS
  https: true
  
  # 缓存控制配置（秒）
  cacheControl:
    # static: CSS/JS/字体等静态资源缓存时间（秒）
    static: 31536000
    # images: 图片资源缓存时间（秒）
    images: 604800
    # default: 其他资源默认缓存时间（秒）
    default: 3600
  
  # CDN识别模式（自动检测主流CDN）
  # 支持的CDN：Cloudflare、阿里云CDN、腾讯云CDN、AWS CloudFront、百度云CDN、七牛云、UCloud等

# ----------------------------------------
#          性能优化配置
# ----------------------------------------
performance:
  # keepAlive: TCP Keep-Alive 配置
  keepAlive:
    # enabled: 是否启用 Keep-Alive
    enabled: true
    # initialDelay: 初始延迟（毫秒）
    initialDelay: 1000
    # timeout: 超时时间（毫秒）
    timeout: 120000
  # http2Push: HTTP/2 服务端推送配置
  http2Push:
    # enabled: 是否启用关键资源推送
    enabled: false
    # criticalAssets: 需要推送的关键资源路径列表
    criticalAssets:
      - "/static/css/main.css"
      - "/static/js/main.js"
  # connectionPool: 连接池配置
  connectionPool:
    # maxSockets: 每个主机最大 socket 数
    maxSockets: 50
    # maxFreeSockets: 最大空闲 socket 数
    maxFreeSockets: 10
    # timeout: 空闲超时（毫秒）
    timeout: 30000

# ----------------------------------------
#            其他配置
# ----------------------------------------
misc:
  # detectPublicIP: 是否自动检测公网 IP（用于显示外网访问地址）
  detectPublicIP: true
  # defaultRoute: 404 时的默认重定向路径
  defaultRoute: "/"