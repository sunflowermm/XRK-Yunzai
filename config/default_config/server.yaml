# 服务器配置文件
# 该配置用于控制HTTP/HTTPS服务器的行为

# 服务器基础配置
server:
  # 服务器名称
  name: "XRK Webserver"
  
  # 服务器监听地址
  # 0.0.0.0 表示监听所有网络接口
  # 127.0.0.1 表示仅监听本地回环
  host: "0.0.0.0"
  
  # 服务器基础URL（用于外部访问）
  # 留空则自动检测
  url: ""

# 域名配置
domain:
  # 是否启用域名解析
  enabled: false
  
  # 主域名列表
  # 支持多个域名，第一个为主域名
  hosts:
    - "xrkk.cc"
  
  # 域名重定向规则
  redirects:
    # 强制重定向到主域名（默认关闭，避免与nginx冲突）
    enforceMain: false
    # 强制使用HTTPS（当HTTPS启用时）
    enforceHttps: true
    # 重定向状态码 (301永久/302临时)
    statusCode: 301
  
  # 域名路由映射
  # 不同域名可映射到不同目录
  routes:
    "xrkk.cc": "www"

# HTTPS配置
https:
  # 是否启用HTTPS
  enabled: true
  
  # SSL证书配置
  # 支持单证书或多域名证书 如果是 Let's Encrypt 请自己配置动续签
  certificates:
    # 默认证书
    default:
      key: "/etc/letsencrypt/live/xrkk.cc/privkey.pem"
      cert: "/etc/letsencrypt/live/xrkk.cc/fullchain.pem"
      # 可选：证书链
      ca: ""
    
    # 域名特定证书（可选）
    domains: {}
  
  # SSL/TLS选项
  options:
    # 最小TLS版本
    minVersion: "TLSv1.2"
    # 是否启用HTTP/2
    http2: true
    # HSTS（HTTP严格传输安全）配置
    hsts:
      enabled: false
      maxAge: 31536000
      includeSubDomains: true
      preload: false

# 静态文件服务配置
static:
  # 默认静态目录
  - route: "/"
    path: "www"
    # 默认文档
    index: ["index.html", "index.htm"]
    # 配置选项
    options:
      # 是否显示目录列表
      browse: false
      # 点文件处理 (deny/allow/ignore)
      dotfiles: "deny"
      # 缓存控制
      maxAge: "1d"
      # 是否启用ETag
      etag: true
      # 是否启用Last-Modified
      lastModified: true
      # 文件扩展名优先级
      extensions: ["html", "htm"]
  
  # 其他静态目录
  - route: "/static"
    path: "static"
    options:
      browse: false
      maxAge: "7d"
  
  - route: "/public"
    path: "public"
    options:
      browse: true
      maxAge: "1h"

# 安全配置
security:
  # Helmet安全头配置
  helmet:
    enabled: true
    csp:
      enabled: false
  
  # CORS跨域配置
  cors:
    enabled: true
    origins: ["*"]
    methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
    headers: ["Content-Type", "Authorization", "X-API-Key"]
    credentials: false
    maxAge: 86400
  
  # 隐藏文件模式
  hiddenFiles:
    - "^\\..*"
    - "node_modules"
    - "\\.git"
    - "\\.env"
    - "config/"
    - "private/"

# 认证配置
auth:
  # API密钥认证
  apiKey:
    enabled: true
    # 密钥文件路径
    file: "config/server_config/api_key.json"
    # 密钥长度
    length: 64
  
  # 白名单路径（无需认证）
  whitelist:
    - "/"
    - "/www"
    - "/static"
    - "/public"
    - "/favicon.ico"
    - "/health"
    - "/robots.txt"
  
  # 跳过认证的路径
  skip:
    - "/api/public"

# 速率限制配置
rateLimit:
  enabled: true
  
  # 全局限制
  global:
    windowMs: 900000  # 15分钟
    max: 1000         # 最大请求数
    message: "请求过于频繁，请稍后再试"
  
  # API限制
  api:
    windowMs: 60000   # 1分钟
    max: 60          # 最大请求数
    message: "API请求过于频繁"
  
  # 静态文件限制
  static:
    windowMs: 60000
    max: 300
  
  # 跳过本地连接
  skipLocal: true

# 请求限制
limits:
  # URL编码数据大小
  urlencoded: "10mb"
  # JSON数据大小
  json: "10mb"
  # 原始数据大小
  raw: "50mb"
  # 文本数据大小
  text: "10mb"
  # 文件上传大小
  fileSize: "100mb"

# 压缩配置
compression:
  enabled: true
  # 压缩级别 (0-9)
  level: 6
  # 最小压缩大小
  threshold: 1024

# 日志配置
logging:
  # 请求日志
  requests: true
  # 错误日志
  errors: true
  # 调试日志
  debug: false
  # 静默路径
  quiet:
    - "/health"
    - "/favicon.ico"

# 其他配置
misc:
  # 是否检测公网IP
  detectPublicIP: true
  # 默认路由（404时重定向）
  defaultRoute: "/"
  # 是否启用文件目录浏览
  directoryListing: false